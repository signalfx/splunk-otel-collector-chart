---
splunkObservability:
   realm:       CHANGEME
   accessToken: CHANGEME
   ingestUrl: {{ .AgentEndpoint }}
   apiUrl: {{ .ApiURLEndpoint }}

splunkPlatform:
  token: foobar
  endpoint: {{ .LogHecEndpoint }}
  metricsEnabled: true
  metricsIndex: myMetricsIndex

autodetect:
  prometheus: true

logsCollection:
  journald:
    useHostJournalctl: true
    enabled: true
    directory: /var/log/journal
    units:
      - name: kubelet
        priority: info

agent:
  config:
    exporters:
      {{ if (eq .KubeTestEnv "eks") }}
      file:
        path: /tmp/metrics.json
      {{ end }}
      otlp:
        endpoint: {{ .OtlpEndpoint }}
        tls:
          insecure: true
      splunk_hec/platform_metrics:
        endpoint: {{ .MetricHecEndpoint }}
    service:
      pipelines:
        {{ if (eq .KubeTestEnv "eks") }}
        metrics/agent:
          exporters:
            - file
        {{ end }}
        traces:
          exporters:
            - otlp
clusterReceiver:
  eventsEnabled: true
  config:
    exporters:
      {{ if (eq .KubeTestEnv "eks") }}
      file:
        path: /tmp/metrics.json
      {{ end }}
      signalfx:
        ingest_url: {{ .K8sClusterEndpoint }}
        tls:
          insecure: true
      splunk_hec/platform_logs:
        endpoint: {{ .LogObjectsHecEndpoint }}
    {{ if (eq .KubeTestEnv "eks") }}
    service:
      pipelines:
        metrics/collector:
          exporters:
            - file
    {{ end }}

  k8sObjects:
    - name: pods
    - name: namespaces
    - name: nodes
    - name: events
      mode: watch

extraAttributes:
  fromAnnotations:
    - key: splunk.com/customField
      tag_name: customField
  fromLabels:
    - key: app
      from: pod
    - key: app
      from: namespace

  custom:
   - name: "cluster_name"
     value: "ci-k8s-cluster"
   - name: "customfield1"
     value: "customvalue1"
   - name: "customfield2"
     value: "customvalue2"

environment: dev
operatorcrds:
  install: true
operator:
  enabled: true
targetAllocator:
  enabled: true


{{ if (eq .KubeTestEnv "eks") }}
cloudProvider: aws
distribution: eks
{{ else }}
clusterName: dev-operator
{{ end }}

featureGates:
  enableEKSApiServerMetrics: true
